# Set up the prompt

autoload -Uz promptinit
autoload -Uz vcs_info
setopt prompt_subst
promptinit
prompt walters

case $TERM in
    screen)
        preexec() {
            echo -ne "\ek$1\e\\"
        }
        precmd() {
            echo -ne "\ek$(basename $SHELL)\e\\"
        }
        ;;
esac

# Kill Ctrl+D key
#setopt ignoreeof

PATH=$HOME/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/bin/X11:/usr/games

if [ -d /usr/pkg ]; then
    PATH=/usr/pkg/bin:/usr/pkg/sbin:$PATH
fi

if [ -d /usr/local/texlive/2014/bin/x86_64-darwin ]; then
    PATH=/usr/local/texlive/2014/bin/x86_64-darwin:$PATH
fi

if [ -d $HOME/bin/python/bin ]; then
    PATH=$HOME/bin/python/bin:$PATH
fi

if [ -d $HOME/.rbenv ]; then
    PATH=$HOME/.rbenv/bin:$PATH
    eval "$(rbenv init -)"
fi

if [ -d $HOME/.pyenv ]; then
    PATH=$HOME/.pyenv/bin:$PATH
    eval "$(pyenv init -)"
fi

if [ -d $HOME/.plenv ]; then
    PATH=$HOME/.plenv/bin:$PATH
    eval "$(plenv init -)"
fi

if [ -d $HOME/.ndenv ]; then
    PATH=$HOME/.ndenv/bin:$PATH
    eval "$(ndenv init -)"
fi

if [ -d $HOME/.rvm ]; then
    PATH=$HOME/.rvm/bin:$PATH
fi

fpath=($HOME/.zsh/completion $fpath)

export EDITOR=vi
export PIP_FIND_LINKS=$HOME/.pip/wheel

# Set locale
export LANG=ja_JP.UTF-8
export LC_ALL=ja_JP.UTF-8

# Use emacs keybindings even if our EDITOR is set to vi
bindkey -e

# Keep 100,000 lines of history within the shell and save it to ~/.zsh_history:
HISTSIZE=100000
SAVEHIST=100000
HISTFILE=/tmp/.zsh_history

setopt hist_ignore_dups
setopt share_history

# Aliases
alias ls='ls -F'
alias vi='vim'
alias pstree='pstree -A'
eval "$(hub alias -s)"  # replace `git` by `hub` command

# reverse menu compeltion (Shift + Tab)
bindkey "\e[Z" reverse-menu-complete

# Use modern completion system
autoload -Uz compinit
compinit

if [ -x /usr/bin/dircolors ]; then
    eval "$(dircolors -b)"
fi 

zstyle ':completion:*' auto-description 'specify: %d'
zstyle ':completion:*' completer _expand _complete _correct _approximate
zstyle ':completion:*' group-name ''
zstyle ':completion:*' menu select=2
zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' list-colors ''
zstyle ':completion:*' list-prompt %SAt %p: Hit TAB for more, or the character to insert%s
zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z}' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=* l:|=*'
zstyle ':completion:*' menu select=long
zstyle ':completion:*' select-prompt %SScrolling active: current selection at %p%s
zstyle ':completion:*' use-compctl false
zstyle ':completion:*' users ''
zstyle ':completion:*' verbose true

zstyle ':completion:*:(all-|)files' ignored-patterns "(*.pyc|*.egg-info)"
zstyle ':completion:*:cd:*' ignored-patterns "(*/)#*.egg-info"
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;31'
zstyle ':completion:*:kill:*' command 'ps -u $USER -o pid,%cpu,tty,cputime,cmd'

# known_hosts completion
_cache_hosts=(fomalhaut capella $(fgrep 'Host ' ~/.ssh/config | grep -v '*' | awk '{print $2}' | sort))
